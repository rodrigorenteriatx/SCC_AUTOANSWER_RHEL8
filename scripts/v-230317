#!/bin/bash

# 1861
# RULE             : Executable search paths within the initialization files of all local interactive RHEL 8 users must only contain paths that resolve to the system default or the users home directory.
# QUESTION_TEXT    : Verify that all local interactive user initialization file executable search path statements do not contain statements that will reference a working directory other than user home directories with the following commands:

# $ sudo grep -i path= /home/*/.*

# /home/[localinteractiveuser]/.bash_profile:PATH=$PATH:$HOME/.local/bin:$HOME/bin

# If any local interactive user initialization files have executable search path statements that include directories outside of their home directory and is not documented with the ISSO as an operational requirement, this is a finding.

check_v_230317 () {



    local finding=0
    initfiles=(.bash_profile .bashrc .profile .csh .cshrc)

    adquery user | awk -F : '{print $1}' | while read -r user; do
        homedir=$(getent passwd "$user" | cut -d : -f 6)
        ls "$homedir" >/dev/null 2>&1
        for f in "$initfiles[@]"; do
            fpath="$homedir/$f"
            if [ -f $fpath ]; then
                echo "Checking homedir of $user"
                grep -i path= "$fpath"
                if [ $? -eq 0 ]; then
                    echo "PATH reference found"
                    finding=1
                fi
            fi
        done
    done

    return $finding

}
check_v_230317
